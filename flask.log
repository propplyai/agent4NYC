INFO:googlemaps.client:API queries_quota: 60
Client created with credentials from config.py.
 * Serving Flask app 'app'
 * Debug mode: on
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.16.162.222:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug: * Restarting with stat
INFO:googlemaps.client:API queries_quota: 60
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 756-671-985
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:00:53] "GET /health HTTP/1.1" 200 -
INFO:webhook_service:Sending compliance data to webhook: https://klevaideas.app.n8n.cloud/webhook/compliance_analysis
INFO:webhook_service:Property: 140 WEST 28 STREET
ERROR:webhook_service:Webhook request timed out
INFO:vendor_marketplace:Getting vendors for property: 140 WEST 28 STREET
INFO:vendor_marketplace:Categories needed: ['hpd', 'elevator', 'boiler', 'electrical', 'fire_safety']
INFO:vendor_service:Searching for hpd contractors near 140 WEST 28 STREET
INFO:vendor_service:Found 5 contractors for hpd
INFO:vendor_service:Searching for elevator contractors near 140 WEST 28 STREET
INFO:vendor_service:Found 4 contractors for elevator
INFO:vendor_service:Searching for boiler contractors near 140 WEST 28 STREET
INFO:vendor_service:Found 4 contractors for boiler
INFO:vendor_service:Searching for electrical contractors near 140 WEST 28 STREET
INFO:vendor_service:Found 5 contractors for electrical
INFO:vendor_service:Searching for fire_safety contractors near 140 WEST 28 STREET
INFO:vendor_service:Found 4 contractors for fire_safety
INFO:vendor_marketplace:Successfully retrieved vendors for 5 categories
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:01:51] "POST /api/analyze-property HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in '/Users/art3a/agent4NYC/webhook_service.py', reloading
Client created with credentials from config.py.
[DEBUG] Received request: POST http://127.0.0.1:5000/api/analyze-property
[DEBUG] Analyzing address: '140 West 28th Street, New York, NY'
Analyzing property: 140 West 28th Street, New York, NY
🏢 COMPREHENSIVE PROPERTY COMPLIANCE ANALYSIS
Address: 140 West 28th Street, New York, NY
================================================================================

🔍 STEP 1: PROPERTY IDENTIFICATION
----------------------------------------
🌐 Using NYC Planning GeoSearch API...
✅ NYC GeoSearch API: Found 140 WEST 28 STREET
   BIN: 1015093, BBL: 1008030062
   Borough: MANHATTAN, Block/Lot: 803/62

🔍 STEP 2: COMPREHENSIVE DATA GATHERING
----------------------------------------
🏠 Gathering HPD violations...
   🔍 Searching by BIN: 1015093
   🔍 Fallback: Searching by block/lot: 803/62
   ✅ Found 4 HPD violations (block/lot search)
🏗️ Gathering DOB violations...
   🔍 Searching by BIN: 1015093
   ✅ Found 10 DOB violations (BIN search)
🛗 Gathering elevator data...
   ✅ Found 8 elevator records (BIN search)
🔥 Gathering boiler data...
   🔍 Searching by BIN: 1015093
   ✅ Found 9 boiler records
   📊 Latest inspection: 11/23/2022 00:00:00
   📊 Active boilers: 9, With defects: 0
🏢 Gathering Certificate of Occupancy data...
   ❌ Certificate of Occupancy error: list indices must be integers or slices, not str
⚡ Gathering electrical permits...
   ✅ Found 11 electrical permit records
   📊 Latest permit: I1 - Status: Permit Issued (2023-07-14T00:00:00.000)
   📊 Job description: General Wiring for 5 Elevators. ELA - 47 stops, ELB- 47 stops, ELD - 47 stops, ELC - 47 stops, SE1 2. This application supersedes Thyssenkrupp M00169160  -Joseph Braman, Lic. #010552. Contractor job #621599.
   📊 Active permits: 1
   📊 Completion date: 2023-12-31T00:00:00.000

📊 STEP 3: CREATING COMPLIANCE RECORD
----------------------------------------
✅ Compliance record created
   Overall Score: 90.0/100
   HPD: 4 total, 1 active
   DOB: 10 total, 0 active
   Elevators: 8 total, 6 active
   Boilers: 9 total
   Electrical: 11 permits, 2 active
🤖 Sending compliance data to AI agent for REAL analysis...
✅ Raw AI response received: <class 'NoneType'>
🔍 Raw response content: None
❌ No AI analysis received from webhook
Getting vendor recommendations...
✅ Found vendors for 5 categories
Final result being sent to frontend:
- success: True
- ai_analysis present: True
- ai_analysis type: <class 'NoneType'>
- vendor_recommendations present: True
- vendor categories: ['hpd', 'elevator', 'boiler', 'electrical', 'fire_safety']
INFO:werkzeug: * Restarting with stat
INFO:googlemaps.client:API queries_quota: 60
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 756-671-985
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:02:21] "GET / HTTP/1.1" 200 -
INFO:webhook_service:Sending compliance data to webhook: https://klevaideas.app.n8n.cloud/webhook/compliance_analysis
INFO:webhook_service:Property: 1662 PARK AVENUE
ERROR:webhook_service:Webhook request timed out
INFO:vendor_marketplace:Getting vendors for property: 1662 PARK AVENUE
INFO:vendor_marketplace:Categories needed: ['hpd', 'dob', 'boiler', 'fire_safety']
INFO:vendor_service:Searching for hpd contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 5 contractors for hpd
INFO:vendor_service:Searching for dob contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 4 contractors for dob
INFO:vendor_service:Searching for boiler contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 4 contractors for boiler
INFO:vendor_service:Searching for fire_safety contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 5 contractors for fire_safety
INFO:vendor_marketplace:Successfully retrieved vendors for 4 categories
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:03:20] "POST /api/analyze-property HTTP/1.1" 200 -
INFO:werkzeug: * Detected change in '/Users/art3a/agent4NYC/webhook_service.py', reloading
Client created with credentials from config.py.
[DEBUG] Received request: POST http://b0401504e113.ngrok-free.app/api/analyze-property
[DEBUG] Analyzing address: '1662 Park Avenue, New York, NY 10035'
Analyzing property: 1662 Park Avenue, New York, NY 10035
🏢 COMPREHENSIVE PROPERTY COMPLIANCE ANALYSIS
Address: 1662 Park Avenue, New York, NY 10035
================================================================================

🔍 STEP 1: PROPERTY IDENTIFICATION
----------------------------------------
🌐 Using NYC Planning GeoSearch API...
✅ NYC GeoSearch API: Found 1662 PARK AVENUE
   BIN: 1051687, BBL: 1016230034
   Borough: MANHATTAN, Block/Lot: 1623/34

🔍 STEP 2: COMPREHENSIVE DATA GATHERING
----------------------------------------
🏠 Gathering HPD violations...
   🔍 Searching by BIN: 1051687
   🔍 Fallback: Searching by block/lot: 1623/34
   ✅ Found 201 HPD violations (block/lot search)
🏗️ Gathering DOB violations...
   🔍 Searching by BIN: 1051687
   ✅ Found 11 DOB violations (BIN search)
🛗 Gathering elevator data...
   ❌ No elevator records found
🔥 Gathering boiler data...
   🔍 Searching by BIN: 1051687
   ✅ Found 10 boiler records
   📊 Latest inspection: 07/25/2019 00:00:00
   📊 Active boilers: 8, With defects: 2
🏢 Gathering Certificate of Occupancy data...
   ❌ No Certificate of Occupancy records found
   ⚠️  This may indicate occupancy compliance issues
⚡ Gathering electrical permits...
   ✅ Found 2 electrical permit records
   📊 Latest permit: I1 - Status: Complete (2019-06-07T00:00:00.000)
   📊 Job description: Scaffold lighting
   📊 Active permits: 0
   📊 Completion date: 2020-06-03T00:00:00.000

📊 STEP 3: CREATING COMPLIANCE RECORD
----------------------------------------
✅ Compliance record created
   Overall Score: 55.0/100
   HPD: 201 total, 12 active
   DOB: 11 total, 2 active
   Elevators: 0 total, 0 active
   Boilers: 10 total
   Electrical: 2 permits, 0 active
🤖 Sending compliance data to AI agent for REAL analysis...
✅ Raw AI response received: <class 'NoneType'>
🔍 Raw response content: None
❌ No AI analysis received from webhook
Getting vendor recommendations...
✅ Found vendors for 4 categories
Final result being sent to frontend:
- success: True
- ai_analysis present: True
- ai_analysis type: <class 'NoneType'>
- vendor_recommendations present: True
- vendor categories: ['hpd', 'dob', 'boiler', 'fire_safety']
INFO:werkzeug: * Restarting with stat
INFO:googlemaps.client:API queries_quota: 60
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 756-671-985
INFO:werkzeug: * Detected change in '/Users/art3a/agent4NYC/webhook_service.py', reloading
Client created with credentials from config.py.
INFO:werkzeug: * Restarting with stat
INFO:googlemaps.client:API queries_quota: 60
WARNING:werkzeug: * Debugger is active!
INFO:werkzeug: * Debugger PIN: 756-671-985
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:04:52] "GET / HTTP/1.1" 200 -
INFO:webhook_service:Sending compliance data to webhook: https://klevaideas.app.n8n.cloud/webhook/compliance_analysis
INFO:webhook_service:Property: 1662 PARK AVENUE
INFO:webhook_service:Starting AI analysis request at 2025-08-01T16:05:04.685805
INFO:webhook_service:AI analysis request completed at 2025-08-01T16:05:36.028230
INFO:webhook_service:Webhook request successful - Status: 200
INFO:webhook_service:Received AI analysis response
Client created with credentials from config.py.
[DEBUG] Received request: POST http://b0401504e113.ngrok-free.app/api/analyze-property
[DEBUG] Analyzing address: '1662 Park Avenue, New York, NY 10035'
Analyzing property: 1662 Park Avenue, New York, NY 10035
🏢 COMPREHENSIVE PROPERTY COMPLIANCE ANALYSIS
Address: 1662 Park Avenue, New York, NY 10035
================================================================================

🔍 STEP 1: PROPERTY IDENTIFICATION
----------------------------------------
🌐 Using NYC Planning GeoSearch API...
✅ NYC GeoSearch API: Found 1662 PARK AVENUE
   BIN: 1051687, BBL: 1016230034
   Borough: MANHATTAN, Block/Lot: 1623/34

🔍 STEP 2: COMPREHENSIVE DATA GATHERING
----------------------------------------
🏠 Gathering HPD violations...
   🔍 Searching by BIN: 1051687
   🔍 Fallback: Searching by block/lot: 1623/34
   ✅ Found 201 HPD violations (block/lot search)
🏗️ Gathering DOB violations...
   🔍 Searching by BIN: 1051687
   ✅ Found 11 DOB violations (BIN search)
🛗 Gathering elevator data...
   ❌ No elevator records found
🔥 Gathering boiler data...
   🔍 Searching by BIN: 1051687
   ✅ Found 10 boiler records
   📊 Latest inspection: 07/25/2019 00:00:00
   📊 Active boilers: 8, With defects: 2
🏢 Gathering Certificate of Occupancy data...
   ❌ No Certificate of Occupancy records found
   ⚠️  This may indicate occupancy compliance issues
⚡ Gathering electrical permits...
   ✅ Found 2 electrical permit records
   📊 Latest permit: I1 - Status: Complete (2019-06-07T00:00:00.000)
   📊 Job description: Scaffold lighting
   📊 Active permits: 0
   📊 Completion date: 2020-06-03T00:00:00.000

📊 STEP 3: CREATING COMPLIANCE RECORD
----------------------------------------
✅ Compliance record created
   Overall Score: 55.0/100
   HPD: 201 total, 12 active
   DOB: 11 total, 2 active
   Elevators: 0 total, 0 active
   Boilers: 10 total
   Electrical: 2 permits, 0 active
🤖 Sending compliance data to AI agent for REAL analysis...
✅ Raw AI response received: <class 'list'>
🔍 Raw response content: [{'output': {'property_analysis': {'address': '1662 PARK AVENUE', 'overall_risk_assessment': {'risk_level': 'MODERATE', 'risk_score': '55', 'primary_risk_factors': ['12 active HPD violations including some with code compliance issues', '2 active DOB violations related to boiler inspection filings', 'Presence of rent-impairing violations historically', 'Overall compliance score at 55/100 with HPD compliance at 0/100'], 'risk_summary': 'While the property has several closed violations historically demonstrating maintenance efforts, the presence of 12 active HPD violations and 2 active DOB violations, especially related to boiler filing requirements and late certifications, pose a moderate risk. The HPD compliance score of 0 and overall score of 55 reflect ongoing compliance challenges that require attention but do not yet reach high or critical risk thresholds.'}, 'compliance_insights': {'strengths': ['Elevator compliance is excellent with a perfect score and no active elevator-related violations', 'Electrical permits show completed and paid jobs with no active open permits indicating good electrical compliance', 'Boiler inspection reports mostly accepted with recent inspections showing no defects'], 'immediate_concerns': ['Several active HPD violations remain open, some related to timely repair and maintenance such as late certification and repair of defective tiles and surfaces', 'Active DOB violations for failure to file annual boiler inspection reports, indicating administrative compliance lapses', 'Some past rent-impairing violations suggest potential tenant impact risks if unresolved'], 'trends_analysis': 'The violation history shows repetitive issues with repairs of defective plaster, paint, flooring, and compliance with lead-based paint hazard regulations. The DOB boiler violations highlight recurring filing and certification challenges. The electrical compliance is steady with little recent activity.', 'compliance_trajectory': 'Current data points to gradual improvement potential if active violations are addressed promptly, mainly focusing on outstanding HPD repairs and DOB filings to improve HPD compliance score from 0.'}, 'priority_actions': [{'priority': 'HIGH', 'category': 'HPD Violations Remediation', 'action': 'Address all open HPD violations promptly, especially those related to repair of defective surfaces and late certifications to avoid escalation and potential fines.', 'reason': 'Active HPD violations with reported defects and late statuses may escalate into critical penalties and impact tenant safety.', 'estimated_cost': '$15,000 - $30,000', 'timeline': 'Within 30 days'}, {'priority': 'HIGH', 'category': 'DOB Boiler Compliance', 'action': 'File outstanding annual low pressure boiler inspection reports and ensure timely compliance with DOB filing requirements.', 'reason': 'Two active DOB violations for failure to file boiler inspection reports expose the property to fines and legal risks.', 'estimated_cost': '$2,000 - $5,000 (including potential fines)', 'timeline': 'Within 15 days'}, {'priority': 'MEDIUM', 'category': 'Lead Paint Hazard Compliance', 'action': 'Complete remediation and certification for identified lead-based paint hazards with certified contractors following NYC regulations.', 'reason': 'Lead paint hazards were highlighted and defect letters issued; addressing them mitigates health risks and legal liabilities.', 'estimated_cost': '$10,000 - $20,000', 'timeline': 'Within 60 days'}, {'priority': 'MEDIUM', 'category': 'Preventive Maintenance', 'action': 'Implement scheduled inspections and maintenance for plaster, paint, flooring, and electrical wiring to reduce recurring violations.', 'reason': 'Recurring repair needs indicate systemic maintenance gaps; preventive care will reduce future violations.', 'estimated_cost': '$5,000 annually', 'timeline': 'Ongoing maintenance program'}], 'financial_impact': {'potential_fines': '$10,000+ if current active violations escalate', 'maintenance_costs': '$30,000 - $55,000 estimated for remediation and preventive measures', 'risk_of_penalties': 'High risk for DOB fines related to boiler report failures and HPD violation escalations if unaddressed', 'cost_benefit_analysis': 'Investing in prompt violation remediation and compliance filing reduces risk of costly fines and legal actions, while improving tenant satisfaction and building valuation.'}, 'regulatory_intelligence': {'upcoming_inspections': 'Boiler inspection filing deadlines approaching; proactive documentation recommended', 'seasonal_considerations': 'Winter months demand functional heating and boiler compliance, increasing urgency for boiler-related remediation', 'regulatory_changes': 'Monitor NYC DOB updates on boiler inspection filing requirements and HPD rules for lead hazard remediation', 'best_practices': ['Maintain up-to-date filings for all required inspections', 'Engage licensed contractors for all repairs and lead hazard abatements', 'Conduct routine preventive maintenance to address common repair areas proactively']}, 'vendor_recommendations': {'hpd_issues': 'Experienced general contractors for plaster, paint, flooring repairs, and pest control specialists for rodent abatements', 'dob_issues': 'Licensed boiler inspection and compliance filing specialists', 'elevator_maintenance': 'N/A - no elevator devices recorded', 'electrical_work': 'Licensed electrician for ongoing inspections and any corrective wiring work', 'boiler_services': 'Certified boiler maintenance and inspection vendors specialized in NYC low pressure boilers'}, 'market_intelligence': {'neighborhood_comparison': 'Located in Manhattan, NYC’s competitive multifamily market with moderate compliance challenges compared to peers', 'property_type_benchmarks': 'Typical multifamily building in the borough with average compliance issues but room for improvement', 'market_trends': 'Increasing regulatory scrutiny on lead hazards and boiler compliance; growing importance of proactive maintenance in NYC multifamily properties'}}, 'ai_confidence': 'High confidence in analysis based on detailed and current violation and inspection data', 'analysis_timestamp': '2025-08-01T16:05:04.685664', 'recommendations_summary': 'Address open HPD violations promptly focusing on repairs and certifications, resolve DOB boiler filing issues immediately to avoid fines, remediate lead paint hazards in compliance with NYC law, and implement preventive maintenance to sustain compliance and building safety.'}}]INFO:vendor_marketplace:Getting vendors for property: 1662 PARK AVENUE
INFO:vendor_marketplace:Categories needed: ['hpd', 'dob', 'boiler', 'fire_safety']
INFO:vendor_service:Searching for hpd contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 5 contractors for hpd
INFO:vendor_service:Searching for dob contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 4 contractors for dob
INFO:vendor_service:Searching for boiler contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 4 contractors for boiler
INFO:vendor_service:Searching for fire_safety contractors near 1662 PARK AVENUE
INFO:vendor_service:Found 4 contractors for fire_safety
INFO:vendor_marketplace:Successfully retrieved vendors for 4 categories
INFO:werkzeug:127.0.0.1 - - [01/Aug/2025 16:05:52] "POST /api/analyze-property HTTP/1.1" 200 -
