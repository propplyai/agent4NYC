{% extends "propply/base.html" %}

{% block title %}Compliance - Propply AI{% endblock %}
{% block page_title %}Compliance Management{% endblock %}
{% block page_subtitle %}Track and manage all compliance requirements{% endblock %}

{% block content %}
<!-- Compliance Overview -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="overview-card">
            <div class="card-icon bg-success">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="card-content">
                <div class="card-value">87.5%</div>
                <div class="card-label">Overall Compliance</div>
                <div class="card-change positive">
                    <i class="fas fa-arrow-up"></i> 5% improvement
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="overview-card">
            <div class="card-icon bg-warning">
                <i class="fas fa-clock"></i>
            </div>
            <div class="card-content">
                <div class="card-value">12</div>
                <div class="card-label">Upcoming Deadlines</div>
                <div class="card-change neutral">
                    <i class="fas fa-calendar"></i> Next 30 days
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="overview-card">
            <div class="card-icon bg-danger">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="card-content">
                <div class="card-value">3</div>
                <div class="card-label">Overdue Items</div>
                <div class="card-change negative">
                    <i class="fas fa-arrow-down"></i> Needs attention
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="overview-card">
            <div class="card-icon bg-info">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="card-content">
                <div class="card-value">45</div>
                <div class="card-label">Active Certificates</div>
                <div class="card-change positive">
                    <i class="fas fa-plus"></i> 3 renewed
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compliance Calendar and Tasks -->
<div class="row">
    <div class="col-lg-8 mb-4">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-calendar-alt me-2"></i>
                    Compliance Calendar
                </h3>
                <div class="card-actions">
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary active">Month</button>
                        <button class="btn btn-sm btn-outline-primary">Week</button>
                        <button class="btn btn-sm btn-outline-primary">List</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="complianceCalendar" class="compliance-calendar">
                    <!-- Calendar will be rendered here -->
                    <div class="calendar-header">
                        <button class="btn btn-sm btn-ghost" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h4 id="currentMonth">February 2024</h4>
                        <button class="btn btn-sm btn-ghost" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        
                        <!-- Calendar days will be generated by JavaScript -->
                        <div id="calendarDays" class="calendar-days"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 mb-4">
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-tasks me-2"></i>
                    Priority Tasks
                </h3>
            </div>
            <div class="card-body">
                <div class="priority-tasks">
                    <div class="task-item high-priority">
                        <div class="task-priority"></div>
                        <div class="task-content">
                            <div class="task-title">Boiler Inspection</div>
                            <div class="task-property">123 Main St, Brooklyn</div>
                            <div class="task-due">Due: Feb 28, 2024</div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-sm btn-primary">Schedule</button>
                        </div>
                    </div>
                    
                    <div class="task-item medium-priority">
                        <div class="task-priority"></div>
                        <div class="task-content">
                            <div class="task-title">Elevator Certificate</div>
                            <div class="task-property">456 Oak Ave, Manhattan</div>
                            <div class="task-due">Due: Mar 5, 2024</div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-sm btn-primary">Schedule</button>
                        </div>
                    </div>
                    
                    <div class="task-item low-priority">
                        <div class="task-priority"></div>
                        <div class="task-content">
                            <div class="task-title">Fire Safety Inspection</div>
                            <div class="task-property">789 Pine St, Queens</div>
                            <div class="task-due">Due: Mar 12, 2024</div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-sm btn-primary">Schedule</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Compliance Requirements Table -->
<div class="dashboard-card">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-clipboard-list me-2"></i>
            Compliance Requirements
        </h3>
        <div class="card-actions">
            <select class="form-select form-select-sm me-2" style="width: auto;">
                <option>All Properties</option>
                <option>123 Main St</option>
                <option>456 Oak Ave</option>
                <option>789 Pine St</option>
            </select>
            <button class="btn btn-sm btn-outline-primary">
                <i class="fas fa-filter"></i>
                Filter
            </button>
            <button class="btn btn-sm btn-primary ms-2">
                <i class="fas fa-plus"></i>
                Add Requirement
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Requirement</th>
                        <th>Property</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Due Date</th>
                        <th>Inspector/Vendor</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="requirement-info">
                                <div class="requirement-title">Annual Boiler Inspection</div>
                                <small class="text-muted">Local Law 87 Compliance</small>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <div>123 Main Street</div>
                                <small class="text-muted">Brooklyn, NY</small>
                            </div>
                        </td>
                        <td><span class="badge bg-warning">Boiler</span></td>
                        <td><span class="badge bg-success">Scheduled</span></td>
                        <td>
                            <div>Feb 28, 2024</div>
                            <small class="text-muted">7 days remaining</small>
                        </td>
                        <td>
                            <div>NYC Boiler Services</div>
                            <small class="text-muted">Licensed Inspector</small>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" title="Generate Report">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="requirement-info">
                                <div class="requirement-title">Elevator Annual Test</div>
                                <small class="text-muted">DOB Elevator Division</small>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <div>456 Oak Avenue</div>
                                <small class="text-muted">Manhattan, NY</small>
                            </div>
                        </td>
                        <td><span class="badge bg-info">Elevator</span></td>
                        <td><span class="badge bg-warning">Pending</span></td>
                        <td>
                            <div>Mar 5, 2024</div>
                            <small class="text-muted">14 days remaining</small>
                        </td>
                        <td>
                            <div>Metro Elevator Co.</div>
                            <small class="text-muted">Certified Technician</small>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" title="Generate Report">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="table-danger">
                        <td>
                            <div class="requirement-info">
                                <div class="requirement-title">Fire Safety Inspection</div>
                                <small class="text-muted">FDNY Annual Inspection</small>
                            </div>
                        </td>
                        <td>
                            <div class="property-info">
                                <div>789 Pine Street</div>
                                <small class="text-muted">Queens, NY</small>
                            </div>
                        </td>
                        <td><span class="badge bg-danger">Fire Safety</span></td>
                        <td><span class="badge bg-danger">Overdue</span></td>
                        <td>
                            <div class="text-danger">Jan 15, 2024</div>
                            <small class="text-danger">26 days overdue</small>
                        </td>
                        <td>
                            <div class="text-muted">Not Assigned</div>
                            <small class="text-muted">Requires scheduling</small>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-danger" title="Schedule Urgent">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-info" title="Generate Report">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.compliance-calendar {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 1rem;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.calendar-header h4 {
    margin: 0;
    font-weight: 600;
}

.btn-ghost {
    background: none;
    border: none;
    color: var(--text-secondary);
    padding: 0.5rem;
    border-radius: var(--radius-sm);
}

.btn-ghost:hover {
    background: var(--bg-primary);
    color: var(--text-primary);
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--border-color);
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.calendar-day-header {
    background: var(--bg-primary);
    padding: 0.75rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.calendar-days {
    display: contents;
}

.calendar-day {
    background: var(--bg-primary);
    padding: 0.75rem;
    min-height: 80px;
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.calendar-day:hover {
    background: var(--bg-tertiary);
}

.calendar-day.other-month {
    background: var(--bg-secondary);
    color: var(--text-muted);
}

.calendar-day.today {
    background: var(--primary-color);
    color: white;
}

.calendar-day.has-events::after {
    content: '';
    position: absolute;
    bottom: 4px;
    right: 4px;
    width: 8px;
    height: 8px;
    background: var(--warning-color);
    border-radius: 50%;
}

.priority-tasks {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.task-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    border-left: 4px solid var(--border-color);
}

.task-item.high-priority {
    border-left-color: var(--danger-color);
}

.task-item.medium-priority {
    border-left-color: var(--warning-color);
}

.task-item.low-priority {
    border-left-color: var(--success-color);
}

.task-priority {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    margin-right: 1rem;
    flex-shrink: 0;
}

.task-item.high-priority .task-priority {
    background-color: var(--danger-color);
}

.task-item.medium-priority .task-priority {
    background-color: var(--warning-color);
}

.task-item.low-priority .task-priority {
    background-color: var(--success-color);
}

.task-content {
    flex: 1;
}

.task-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.task-property {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.125rem;
}

.task-due {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.task-actions {
    margin-left: 1rem;
}

.requirement-info .requirement-title {
    font-weight: 600;
    color: var(--text-primary);
}

.property-info div:first-child {
    font-weight: 500;
    color: var(--text-primary);
}

.table-danger {
    background-color: rgba(239, 68, 68, 0.05);
}

.table-danger td {
    border-color: rgba(239, 68, 68, 0.2);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeComplianceCalendar();
});

function initializeComplianceCalendar() {
    const currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    
    function renderCalendar() {
        const monthElement = document.getElementById('currentMonth');
        const calendarDays = document.getElementById('calendarDays');
        
        monthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        
        // Clear previous calendar
        calendarDays.innerHTML = '';
        
        // Get first day of month and number of days
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
        
        // Add previous month's trailing days
        for (let i = firstDay - 1; i >= 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = daysInPrevMonth - i;
            calendarDays.appendChild(dayElement);
        }
        
        // Add current month's days
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            
            // Mark today
            if (currentYear === currentDate.getFullYear() && 
                currentMonth === currentDate.getMonth() && 
                day === currentDate.getDate()) {
                dayElement.classList.add('today');
            }
            
            // Mark days with events (mock data)
            if ([15, 20, 28].includes(day)) {
                dayElement.classList.add('has-events');
            }
            
            calendarDays.appendChild(dayElement);
        }
        
        // Add next month's leading days
        const totalCells = calendarDays.children.length;
        const remainingCells = 42 - totalCells; // 6 rows × 7 days
        for (let day = 1; day <= remainingCells; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day other-month';
            dayElement.textContent = day;
            calendarDays.appendChild(dayElement);
        }
    }
    
    // Event listeners for navigation
    document.getElementById('prevMonth').addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        renderCalendar();
    });
    
    document.getElementById('nextMonth').addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar();
    });
    
    // Initial render
    renderCalendar();
}
</script>
{% endblock %}
